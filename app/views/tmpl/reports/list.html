<div class="page">
	<div class="pageheader">
		<h2>{{page.title}} <span></span></h2>
		<div class="page-bar">
			<ul class="page-breadcrumb">
				<li>
          			<a ui-sref="efinding.dashboard.generic"> {{main.title}}</a>
        		</li>
				<li>
					<a href="javascript:;">Inspecciones</a>
				</li>
				<li>
					<a>{{page.title}}</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="pagecontent">
		<div class="row">
			<div class="col-md-12">
				<section class="tile" fullscreen="isFullscreen06">
					<div class="tile-body">
						<div class="row">
							<div class="col-md-2">
								<input type="image" src="https://s3-sa-east-1.amazonaws.com/efinding/icons/abajo.png" ng-click="openModalDownloadPdfsByMonth()" uib-tooltip="Descargar Excel"></input>
							</div>
						</div>
						<table ng-table="tableParams" show-filter="true" class="table table-custom">
							<thead>
								<tr>
									<th ng-repeat="column in columns" class="text-center sortable">{{column.title}}</th>
									<th class="text-center"> PDF </th>
									<th class="text-center" ng-show="role_type== 'administrator'"> Firma </th>
									<th class="text-center" ng-show="is_superuser"> Eliminar </th>
								</tr>
								<tr>
									<th ng-repeat="column in columns" class="text-center sortable" >
										<div ng-repeat="filtro in column.columnFilters">
											<div ng-if="filter[filtro.name].type  == 'text'" style="margin-bottom: 5px">
												<table cellpadding="100">
													<tr>
														<th style="padding: 5px !important;">
															<span ng-click="sortBy(filter[filtro.name].name)">
														    	<i class="fa fa-caret-up  fa-2x" aria-hidden="true" ng-if="filter[filtro.name].sort_direction == 'asc'" ></i>

														    	<i class="fa fa-caret-down fa-2x" aria-hidden="true" ng-if="filter[filtro.name].sort_direction == 'desc'"></i>
														    </span>
														</th>
														<th style="padding: 1px !important;">
															<input type="text" class="form-control" ng-model="filter[filtro.name].filter" placeholder="{{ filter[filtro.name].placeholder }}"/>
														</th>
													</tr>
												</table>
											</div>

											<div ng-if="filter[filtro.name].type  == 'list'">

												<table>
													<tr>
														<th style="padding: 1px !important;">
														<span ng-click="sortBy(filter[filtro.name].name)">
													    	<input value="up" type="button" ng-if="filter[filtro.name].sort_direction == 'asc'" />

													    	<input value="do" type="button" ng-if="filter[filtro.name].sort_direction == 'desc'"/>
													    </span>
												    	</th>
														<th style="padding: 1px !important;">
															<ui-select ng-model="filter[filtro.name].selected">
													          <ui-select-match placeholder="Buscar...">{{$select.selected.name}}</ui-select-match>
													          <ui-select-choices repeat="collection in filter[filtro.name].data | filter: $select.search">
													            <div ng-bind-html="collection.name | highlight: $select.search"></div>
													          </ui-select-choices>
													        </ui-select>
														</th>
													</tr>
												</table>
											</div>
										</div>
									</th>
									<th class="text-center" ></th>
									<th class="text-center" ng-show="role_type== 'administrator'"></th>
									<th class="text-center" ng-show="is_superuser"></th>
								</tr>
							</thead>

							<tbody>
								<tr ng-repeat="inspection in $data | filter: filtro">
									<td ng-repeat="column in columns" class="text-center">
										<p data-ng-bind-html="trustAsHtml(inspection[column.field_a])"></p>
									</td>
									<td >
										<input ng-if="inspection['pdfUploaded']" class="text-center" type="image" src="https://s3-sa-east-1.amazonaws.com/efinding/icons/PDF.png" uib-tooltip="Descargar PDF" tooltip-placement="bottom" style="width: 20px;" data-pdf="{{inspection.pdf}}" ng-click="downloadPdf($event)"/>

										<i ng-if="!inspection['pdfUploaded']" class="fa fa-ban text-center" style="color: #ACAEAF; font-size: 2.0em" uib-tooltip="PDF no disponible" tooltip-placement="bottom"></i>

										<!--input ng-if="!inspection['pdfUploaded']" class="text-center" type="image" src="http://dhg7r6mxe01qf.cloudfront.net/icons/admin/denied2.png" uib-tooltip="PDF no disponible" tooltip-placement="bottom" style="width: 23px; " data-pdf="{{inspection.pdf}}" /-->

									</td>
									<td ng-show="role_type== 'administrator'" class="text-center">
										<label ng-if="inspection.state == 'reports_pending'">Pendiente de envío</label>
										<a ng-click="FirmaInspeccionInstance(inspection.id)" ng-if="inspection.state == 'first_signature_pending'">Pendiente de firma</a>
										<label ng-if="inspection.state == 'first_signature_done'">Firmado</label>
										<a ng-click="FirmaInspeccionInstance(inspection.id)" ng-if="inspection.state == 'final_signature_pending'">Pendiente de firma final</a>
										<label ng-if="inspection.state == 'finished'">Teminado</label>
									</td>
									<td ng-show="is_superuser" class="text-center">
										<img ng-click="openModalRemoveInspection(inspection.id)" ng-src="http://dhg7r6mxe01qf.cloudfront.net/icons/admin/delete.png" style="width:20px;" tooltip="Borrar inspección">
									</td>
								</tr>
							</tbody>
						</table>
						<div class="row">
							<div class="col-md-6" style="margin: 0 auto;float: none;">
								<pager prev="decrementPage()" next="incrementPage()" change-page="getReports({success:true,detail:'OK'},pagination.pages.current)" current="pagination.pages.current" total="pagination.pages.total"></pager>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>

	<script type="text/ng-template" id="firmarInspeccion.html">
		<div class="modal-content">
			<div class="modal-header ng-scope">
            	<h3 class="modal-title custom-font" style="text-align: center;">FIRMA INSPECCIÓN</h3>
        	</div>
         	<div class="modal-body ng-scope">
         		<div class="alert alert-{{elements.alert.color}}" ng-show="elements.alert.show"> 
         			<h4 class="text-md"><strong>{{elements.alert.title}}</strong></h4> {{elements.alert.text}} 
         		</div>
         		<h4 style="text-align: center;">¿Seguro que quieres firmar la siguiente inspección?</h4>
         		<br>
         		<div style="text-align: center;">
         			<label class="ng-binding" style="font-weight: 900;">Empresa:</label> {{inspection.empresa.text}}
         			<br>
         			<label class="ng-binding" style="font-weight: 900;">Obra:</label> {{inspection.obra.text}}
         			<br>
         			<label class="ng-binding" style="font-weight: 900;">Usuario creador:</label> {{inspection.creador.text}}
         			<br>
         			<label class="ng-binding" style="font-weight: 900;">Fecha de creación:</label> {{inspection.fecha_creacion.text | date: 'dd/MM/yyyy HH:mm:ss'}}
         			<!--br>
         			<label class="ng-binding" style="font-weight: 900;">Fecha de resolución:</label> Nombre 01/01/2016
         			-->
         			<br>
         			<br>
         			<a href="{{inspection.pdf}}" style="text-decoration: none;" target="_blank">
         				<button class="btn btn-orange-ps {{elements.buttons.removeUser.border}}" type="button">{{elements.buttons.ver.text}}</button>
         			</a>
					<button class="btn btn-slategray" ng-disabled="elements.buttons.firmar.disabled" type="button" ng-click="firmar(inspection.id.id)" >{{elements.buttons.firmar.text}}</button>
					<br>
					<label class="checkbox checkbox-custom"> <input type="checkbox" class="ng-untouched ng-valid ng-dirty ng-valid-parse ng-not-empty" ng-change="validaFirma(checkVal)" ng-model="check" aria-invalid="false" style=""><i></i> He visto el PDF </label>
         		</div>
            </div>
        </div>
	</script>
	
	<script type="text/ng-template" id="modalDownloadPdfsByMonth.html">
		<div class="modal-header text-center">
			<h3>Descargar Excel de reportes</h3>
		</div>
		<div class="modal-body">
			<div class="row">
				<div class="col-md-12">
					<div class="alert alert-{{modal.alert.color}}" ng-show="modal.alert.show"> <h4 class="text-md"><strong>{{modal.alert.title}}</strong></h4> {{modal.alert.text}} </div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<form class="form-horizontal" role="form">
						<div class="form-group">
							<label class="col-sm-5 control-label">Descargar reportes del mes</label>
							<div class="col-sm-6">
								<p class="input-group">
									<input type="text" class="form-control" uib-datepicker-popup="MM/yyyy" ng-model="modal.month.date" is-open="modal.datepicker.opened" datepicker-options="{minMode: 'month', showButtonBar: false}" />
									<span class="input-group-btn">
										<button type="button" class="btn btn-default" ng-click="openDatePicker($event)"><i class="glyphicon glyphicon-calendar"></i></button>
									</span>
								</p>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<a class="btn bg-cyan-1-generic btn-rounded-10 mb-10" id="downloadReportsByMonth" ng-href="" ng-click="downloadReports()" ng-disabled="modal.buttons.download.disabled"><i class="fa fa-cloud-download" uib-tooltip="Descargar PDF's"></i> {{modal.buttons.download.text}}</a>
			<button class="btn btn-cancelRecit btn-rounded-10 mb-10" type="button" ng-click="cancel()">Cerrar</button>
		</div>
	</script>

	<script type="text/ng-template" id="removeInspectionModal.html" class="">
  		<div class="modal-body text-gray">
    		<div class="row">
      			<div class="col-md-12">
        			<h4 class="text-center">¿Seguro desea eliminar la inspección <strong>{{modal.inspection.title}}</strong>? </h4>
      			</div>
    		</div>
  		</div>
  		<div class="modal-footer">
  			<button class="btn btn-danger" ng-click="removeInspection({success: true,detail: 'OK'})">Si, eliminar</button>
  			<button class="btn btn-default" ng-click="cancel()">Cancelar</button>
  		</div>
	</script>
</div>
